# SISTEMA SIGEPOLI (ISPTEC)

## CONTEXTO E OBJETIVO
**Sistema de GestÃ£o Escolar PolitÃ©cnica (SIGEPOLI)** - Banco de dados relacional que integra gestÃ£o acadÃ©mica, administrativa e operacional para o Instituto Superior PolitÃ©cnico de Tecnologias e CiÃªncias (ISPTEC).

### 1. Objetivo Geral
Desenhar, modelar e implementar um banco de dados relacional que integre a gestÃ£o acadÃ©mica (cursos, turmas, matrÃ­culas e avaliaÃ§Ãµes), a gestÃ£o de pessoas (professores, coordenadores, administrativos) e a gestÃ£o operacional (contratos com empresas de serviÃ§os de limpeza, seguranÃ§a e cafetaria), garantindo rastreabilidade, controlo de custos e relatÃ³rios de desempenho.

---

### 2. Contexto do Problema
O Instituto Superior PolitÃ©cnico de Tecnologias e CiÃªncias, assim como vÃ¡rios outros institutos, opera com vÃ¡rias Ã¡reas interligadas:

1. **AcadÃ©mica** â€“ oferecimento de cursos, criaÃ§Ã£o de turmas, matrÃ­cula de alunos, atribuiÃ§Ã£o de professores e avaliaÃ§Ã£o de desempenho discente.
2. **Administrativa** â€“ pessoal administrativo distribuÃ­do por departamentos (Secretaria AcadÃ©mica, Tesouraria, Recursos Humanos, Biblioteca, LaboratÃ³rios, etc.).
3. **CoordenaÃ§Ã£o PedagÃ³gica** â€“ coordenadores de curso responsÃ¡veis por currÃ­culos, grade horÃ¡ria e indicadores de qualidade.
4. **Operacional** â€“ contrataÃ§Ã£o e fiscalizaÃ§Ã£o de empresas terceirizadas (limpeza, seguranÃ§a, cafetaria) com metas de SLA (Service Level Agreement) e pagamentos mensais.

O sistema atual apresenta dados dispersos, gerando redundÃ¢ncia, falhas e dificuldade de apuraÃ§Ã£o de custos.

---

### 3. Requisitos Funcionais
- **RF01** â€“ Cadastrar departamentos, incluindo orÃ§amento anual e chefe responsÃ¡vel.
- **RF02** â€“ Registrar colaboradores administrativos, vinculando-os a um departamento.
- **RF03** â€“ Cadastrar professores e respectiva titulaÃ§Ã£o.
- **RF04** â€“ Designar coordenadores por curso.
- **RF05** â€“ Gerir cursos, disciplinas, turmas e horÃ¡rios.
- **RF06** â€“ Processar matrÃ­culas de alunos nas turmas.
- **RF07** â€“ LanÃ§ar avaliaÃ§Ãµes e obter mÃ©dias.
- **RF08** â€“ Cadastrar empresas terceirizadas, contratos e SLA.
- **RF09** â€“ Registar pagamentos mensais Ã s empresas com controle de SLA.
- **RF10** â€“ Gerar relatÃ³rios de carga horÃ¡ria, salas e custos.
- **RF11** â€“ Manter auditoria de alteraÃ§Ãµes sensÃ­veis.

---

### 4. Regras de NegÃ³cio ObrigatÃ³rias
- **RN01** â€“ Um professor nÃ£o pode ter aulas em turmas com horÃ¡rios sobrepostos.
- **RN02** â€“ SÃ³ Ã© permitida matrÃ­cula se houver vaga e propina paga.
- **RN03** â€“ Notas devem estar entre 0â€“20.
- **RN04** â€“ Empresas precisam apresentar garantia vÃ¡lida antes do pagamento.
- **RN05** â€“ SLA inferior a 90% gera multa automÃ¡tica.
- **RN06** â€“ Coordenador deve aprovar carga horÃ¡ria dos professores do curso.

---

#### **EntregÃ¡veis e PontuaÃ§Ã£o**
- **Modelo Conceitual (ER)**: 5 pontos - â‰¥10 entidades, relaÃ§Ãµes N:M resolvidas
- **Modelo LÃ³gico (DER)**: 3 pontos - Tipos adequados, PKs/FKs, 3FN
- **Script DDL**: 2 pontos - CHECK, UNIQUE, INDEX, ON UPDATE/DELETE
- **Procedures**: 2 pontos - Matricular, alocar, processar pagamento
- **Functions**: 3 pontos - MÃ©dia ponderada, percentual SLA
- **Triggers**: 5 pontos - Auditoria, bloqueios automÃ¡ticos
- **Views**: 2 pontos - Grade horÃ¡ria, carga horÃ¡ria, custos
- **Consultas de Teste**: 1 ponto - â‰¥10 INSERTs + â‰¥15 consultas
- **DocumentaÃ§Ã£o**: 2 pontos - Guia implantaÃ§Ã£o, diagrama fÃ­sico

---

## IMPLEMENTACAO

> SGBD -> MySQL

### 6. ESTRUTURA 

#### **Arquivos SQL**
```
sigepoli/
â”œâ”€â”€ sql/
â”‚   â”œâ”€â”€ 01_schema/
â”‚   â”‚   â”œâ”€â”€ 01_create_database.sql
â”‚   â”‚   â”œâ”€â”€ 02_create_tables.sql
â”‚   â”‚   â”œâ”€â”€ 03_create_constraints.sql
â”‚   â”‚   â””â”€â”€ 04_create_indexes.sql
â”‚   â”œâ”€â”€ 02_programmability/
â”‚   â”‚   â”œâ”€â”€ procedures.sql
â”‚   â”‚   â”œâ”€â”€ functions.sql
â”‚   â”‚   â””â”€â”€ triggers.sql
â”‚   â”œâ”€â”€ 03_views/
â”‚   â”‚   â””â”€â”€ views.sql
â”‚   â”œâ”€â”€ 04_data/
â”‚   â”‚   â””â”€â”€ insert_test_data.sql
â”‚   â””â”€â”€ 05_tests/
â”‚       â”œâ”€â”€ test_queries.sql
â”‚       â””â”€â”€ validate_rules.sql
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deploy_completo.sql
â”‚   â”œâ”€â”€ deploy_monolitico.sql
â”‚   â””â”€â”€ reset_database.sql
â”œâ”€â”€ README.md
â”œâ”€â”€ modelo conceitual.md
â”œâ”€â”€ modelo logico.md
â”œâ”€â”€ guia_implantacao.md
â”œâ”€â”€ justificativas_indices.md
â””â”€â”€ relatorio_1_pagina.pdf
```

### 1. ÃREA ACADÃŠMICA ğŸ“š

#### **Estrutura de Cursos e Disciplinas**
- [x] `courses` â€” Cadastro de cursos oferecidos
- [x] `subjects` â€” CatÃ¡logo de disciplinas
- [x] `course_subjects` â€” RelaÃ§Ã£o curso-disciplina com prÃ©-requisitos
- [x] `course_availability` â€” Vagas disponÃ­veis por ano letivo
- [x] `course_fees` â€” DefiniÃ§Ã£o das taxas de curso

#### **GestÃ£o de Turmas e HorÃ¡rios**
- [x] `classes` â€” Turmas por curso
- [x] `time_slots` â€” PerÃ­odos de aula disponÃ­veis
- [x] `class_schedules` â€” HorÃ¡rios das turmas e alocaÃ§Ãµes (disciplina, professor, sala)
- [x] `rooms` â€” Salas de aula e espaÃ§os fÃ­sicos
- [x] `resources` â€” Recursos materiais e equipamentos
- [x] `room_resources` â€” AlocaÃ§Ã£o de recursos por sala
- [x] `room_bookings` â€” Reservas especiais de salas

#### **GestÃ£o de Alunos**
- [x] `students` â€” Dados detalhados dos alunos
- [x] `student_enrollments` â€” MatrÃ­cula dos alunos em cursos
- [x] `class_enrollments` â€” MatrÃ­culas dos alunos em turmas especÃ­ficas
- [x] `student_fees` â€” Registro das propinas e outras taxas dos alunos

#### **GestÃ£o de Professores**
- [x] `teachers` â€” Dados especÃ­ficos dos docentes
- [x] `teacher_specializations` â€” EspecializaÃ§Ãµes e Ã¡reas de atuaÃ§Ã£o dos professores
- [x] `teacher_availability` â€” Disponibilidade e carga horÃ¡ria dos professores

#### **Sistema de AvaliaÃ§Ã£o**
- [x] `grades` â€” Notas e resultados de avaliaÃ§Ãµes dos alunos
- [x] `assessment_types` â€” Tipos de avaliaÃ§Ã£o e seus pesos
- [x] `attendance` â€” Controle de presenÃ§as e faltas dos alunos
- [x] `classes_attended` â€” Registro de aulas ministradas

---

### 2. ÃREA ADMINISTRATIVA ğŸ¢

#### **GestÃ£o de Pessoal**
- [x] `users` â€” Dados centrais de todos os utilizadores (alunos, funcionÃ¡rios, professores)
- [x] `user_roles` â€” DefiniÃ§Ã£o dos papÃ©is e permissÃµes no sistema
- [x] `user_role_assignments` â€” AtribuiÃ§Ã£o de papÃ©is aos utilizadores
- [x] `user_identification` â€” Documentos de identificaÃ§Ã£o dos utilizadores
- [x] `user_health` â€” InformaÃ§Ãµes de saÃºde e necessidades especiais dos utilizadores
- [x] `departments` â€” Estrutura e organizaÃ§Ã£o dos departamentos
- [x] `department_budgets` â€” OrÃ§amento anual e controle de gastos por departamento
- [x] `staff` â€” FuncionÃ¡rios administrativos e tÃ©cnicos
- [x] `academic_qualifications` â€” QualificaÃ§Ãµes acadÃªmicas de funcionÃ¡rios e professores
- [x] `positions` â€” Cargos e funÃ§Ãµes disponÃ­veis na instituiÃ§Ã£o
- [x] `staff_positions` â€” AtribuiÃ§Ã£o de cargos aos funcionÃ¡rios
- [x] `staff_leaves` â€” Registro de fÃ©rias e licenÃ§as dos funcionÃ¡rios
- [x] `evaluation` â€” DefiniÃ§Ã£o de avaliaÃ§Ãµes de desempenho
- [x] `staff_evaluation` â€” AvaliaÃ§Ãµes especÃ­ficas de funcionÃ¡rios
- [x] `course_evaluation` â€” AvaliaÃ§Ãµes de cursos por alunos e feedback
- [x] `performance` â€” Resultados consolidados das avaliaÃ§Ãµes de desempenho
- [x] `course_access` â€” Registro de inscriÃ§Ãµes e provas de acesso a cursos

#### **CoordenaÃ§Ã£o de Cursos**
- [x] `courses.coordinator_staff_id` - Coordenadores atribuÃ­dos aos cursos (RF04)
  - **VALIDAÃ‡ÃƒO**: Apenas coordenadores aprovam carga horÃ¡ria (RN06)

#### **Secretaria AcadÃ©mica (crÃ­tica para ISPTEC)**
- [x] `services` â€” ServiÃ§os prestados pela instituiÃ§Ã£o (ex: emissÃ£o de declaraÃ§Ãµes)
- [x] `service_types` â€” Categorias de serviÃ§os oferecidos
- [x] `service_evaluation` â€” AvaliaÃ§Ãµes da qualidade dos serviÃ§os

#### **Tesouraria (crÃ­tica para ISPTEC)**
- [x] `payments` â€” Registros gerais de todas as transaÃ§Ãµes financeiras
- [x] `payment_types` â€” Tipos de mÃ©todos de pagamento
- [x] `student_payments` â€” Pagamentos especÃ­ficos de alunos (propinas, serviÃ§os)
- [x] `company_payments` â€” Pagamentos a empresas terceirizadas
- [x] `staff_payments` â€” Pagamentos a funcionÃ¡rios (salÃ¡rios, bÃ´nus)
- [x] `fines` â€” Registro de multas aplicadas (atrasos, infraÃ§Ãµes)

#### **Biblioteca**
- [x] `library_items` â€” CatÃ¡logo geral de recursos da biblioteca (livros, periÃ³dicos, etc.)
- [x] `library_loans` â€” EmprÃ©stimos e devoluÃ§Ãµes de itens da biblioteca

---

### 3. ÃREA OPERACIONAL âš™ï¸

#### **GestÃ£o de ServiÃ§os, Pagamentos e Terceirizados**
- [x] `companies` â€” Empresas parceiras e terceirizadas
- [x] `companies_departments` â€” Relacionamento entre empresas e departamentos
- [x] `companies_contracts` â€” Contratos firmados com empresas
- [x] `companies_sla` â€” Acordos de NÃ­vel de ServiÃ§o (SLA) com empresas
- [x] `companies_sla_evaluation` â€” AvaliaÃ§Ãµes de desempenho dos SLAs

#### **Monitoramento e Pagamentos**
  - **VALIDAÃ‡ÃƒO**: Verifica garantia vÃ¡lida antes do pagamento (RN04)
  - **VALIDAÃ‡ÃƒO**: Multa automÃ¡tica se SLA < 90% (RN05)

---

### 4. ÃREAS TRANSVERSAIS ğŸ”„

#### **Auditoria**
- [x] `audit_logs` â€” Logs detalhados de todas as operaÃ§Ãµes sensÃ­veis do sistema

#### **RelatÃ³rios** (Consultas, nÃ£o tabelas)
- **RF10**: RelatÃ³rios de carga horÃ¡ria, salas e custos
- **Views implementadas**:
  - [x] `vw_class_schedule` - Grade horÃ¡ria detalhada por turma.
  - [x] `vw_teacher_workload` - Carga horÃ¡ria total por professor.
  - [x] `vw_department_costs_summary` - Resumo de custos por departamento.

#### **NotificaÃ§Ãµes**
- [x] `notifications` â€” Gerenciamento e envio de notificaÃ§Ãµes aos utilizadores

---

### 5. VALIDAÃ‡Ã•ES E REGRAS DE NEGÃ“CIO

#### **Procedures (RF - Matricular, Alocar, Processar)**
- [x] `EnrollStudentInClass` - MatrÃ­cula de aluno com validaÃ§Ã£o de vaga e propina (RN02)
- [x] `AllocateTeacherToClass` - AlocaÃ§Ã£o de professor sem sobreposiÃ§Ã£o de horÃ¡rios (RN01)
- [x] `ProcessStudentPayment` - Processamento de pagamento de propina

#### **Functions (CÃ¡lculos)**
- [x] `CalculateWeightedAverage` - CÃ¡lculo da mÃ©dia ponderada das notas do aluno
- [x] `CalculateSLAPercentage` - CÃ¡lculo do percentual de SLA alcanÃ§ado

#### **Triggers (ValidaÃ§Ãµes AutomÃ¡ticas e LÃ³gica de NegÃ³cio)**
- [x] `Triggers de Auditoria` - Registram INSERTs, UPDATEs e DELETEs em tabelas sensÃ­veis (RF11).
- [x] `trg_apply_sla_fine` - Aplica multa automÃ¡tica se o percentual de SLA for inferior a 90% (RN05).
- [x] `trg_approve_teacher_availability` - Garante que a aprovaÃ§Ã£o da carga horÃ¡ria de um professor seja feita por um coordenador de curso (RN06).
- [x] `trg_grades_before_insert/update` - Valida que as notas inseridas/atualizadas estejam entre 0-20 (RN03).
- [x] `trg_generate_semester_fees` - Gera automaticamente as taxas de propina por semestre para novas matrÃ­culas de alunos.
- [x] `Triggers de ValidaÃ§Ã£o de Dados` - Implementados em diversas tabelas (`users`, `departments`, `students`, `staff`, `courses`, `subjects`, `classes`, `rooms`, `course_fees`, `student_fees`, `payments`, `payment_types`, `companies`, `companies_contracts`, `companies_sla`, `companies_sla_evaluation`, `assessment_types`, `user_roles`, `class_schedules`, `student_enrollments`) para garantir a integridade e consistÃªncia dos dados, conforme as regras de negÃ³cio.

#### **Views (RelatÃ³rios)**
- [x] `vw_class_schedule` - Grade horÃ¡ria detalhada por curso e turma.
- [x] `vw_teacher_workload` - Carga horÃ¡ria total de aulas de cada professor.
- [x] `vw_department_costs_summary` - Resumo dos custos operacionais por departamento (funcionÃ¡rios, contratos).